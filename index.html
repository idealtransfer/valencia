<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer Valencia</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .error { color: red; font-weight: bold; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #248bed; color: white; border: none; border-radius: 10px; padding: 15px; font-size: 16px; }
    </style>
</head>
<body>
    <h3>Заказ трансфера (Версия 2.0)</h3>
    
    <label>Имя*</label>
    <input type="text" id="user_name" placeholder="Иван">

    <label>Телефон*</label>
    <input type="tel" id="user_phone" value="+34">

    <label>Откуда*</label>
    <input type="text" id="pickup" placeholder="Аэропорт">

    <label>Куда*</label>
    <input type="text" id="destination" placeholder="Отель">

    <label>Дата*</label>
    <input type="date" id="date">
    
    <label>Время*</label>
    <input type="time" id="time">

    <label>Способ связи</label>
    <select id="contact_method">
        <option value="Telegram">Telegram</option>
        <option value="WhatsApp">WhatsApp</option>
    </select>
    
    <input type="hidden" id="flight" value="-">
    <input type="hidden" id="adults" value="1">
    <input type="hidden" id="booster" value="0">
    <input type="hidden" id="child_seat" value="0">
    <input type="hidden" id="luggage" value="0">
    <input type="hidden" id="payment" value="cash">
    <input type="hidden" id="comments" value="-">

    <button id="order-btn">ОТПРАВИТЬ ЗАЯВКУ</button>
    <p id="debug-log" style="color: red; font-size: 12px;"></p>

    <script>
        // Глобальный перехватчик ошибок
        window.onerror = function(msg, url, line) {
            alert("Ошибка кода: " + msg + "\nСтрока: " + line);
            document.getElementById('debug-log').innerText = "Ошибка: " + msg;
            return false;
        };

        const tg = window.Telegram.WebApp;
        tg.expand();

        // Проверка: загрузился ли скрипт
        // alert("Скрипт v2.0 загружен!"); // Раскомментируйте, если нужно проверить кэш

        document.getElementById('order-btn').addEventListener('click', function() {
            try {
                // Сбор данных
                const data = {
                    name: document.getElementById('user_name').value,
                    phone: document.getElementById('user_phone').value,
                    pickup: document.getElementById('pickup').value,
                    destination: document.getElementById('destination').value,
                    date: document.getElementById('date').value,
                    time: document.getElementById('time').value,
                    contact_method: document.getElementById('contact_method').value,
                    // Остальные поля пока заглушки для теста
                    flight: "test", 
                    adults: "1", 
                    booster: "0", 
                    child_seat: "0", 
                    luggage: "0", 
                    payment: "cash", 
                    comments: "-",
                    language: tg.initDataUnsafe?.user?.language_code || 'ru'
                };

                // Проверка
                if(!data.name || !data.pickup || !data.destination) {
                    tg.showAlert("Заполните Имя, Откуда и Куда!");
                    return;
                }

                // Отправка
                tg.sendData(JSON.stringify(data));
                
            } catch (e) {
                alert("Ошибка при клике: " + e.message);
                document.getElementById('debug-log').innerText = "Ошибка клика: " + e.message;
            }
        });
    </script>
</body>
</html>
