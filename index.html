<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; }
        #order-btn {
            background-color: #248bed; color: white; border: none;
            padding: 15px 30px; font-size: 18px; border-radius: 10px;
            cursor: pointer; width: 100%; margin-top: 20px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="form-container">
        <h3>Тестовая форма</h3>
        <p>Заполните любое поле и нажмите кнопку</p>
        
        <input type="text" id="user_name" placeholder="Ваше имя">
        <input type="text" id="pickup" placeholder="Откуда">
        
        <button id="order-btn">ОТПРАВИТЬ (ТЕСТ)</button>
        <p id="log" style="color: gray; font-size: 10px; margin-top: 10px;">Жду нажатия...</p>
    </div>

    <div id="success-screen" class="hidden">
        <h1 style="color: green; font-size: 50px;">✅</h1>
        <h2>Спасибо за заявку!</h2>
        <p>Форма сработала. Данные отправлены в Telegram.</p>
        <button onclick="Telegram.WebApp.close()" style="padding: 10px; background: #ddd; border: none; border-radius: 5px;">Закрыть окно</button>
    </div>

    <script>
        // 1. Инициализация
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Ловим ошибки, чтобы видеть их на экране
        window.onerror = function(msg, url, line) {
            document.getElementById('log').innerText = "Ошибка: " + msg;
            document.getElementById('log').style.color = "red";
        };

        // 2. Главная функция клика
        document.getElementById('order-btn').addEventListener('click', function() {
            
            // Пишем в лог, что клик прошел
            document.getElementById('log').innerText = "Клик получен. Обработка...";

            // Собираем данные (минимум)
            const data = {
                name: document.getElementById('user_name').value || "Не указано",
                pickup: document.getElementById('pickup').value || "Не указано"
            };

            // 3. Пытаемся отправить данные (в try/catch, чтобы не сломать экран успеха)
            try {
                tg.sendData(JSON.stringify(data));
            } catch (e) {
                document.getElementById('log').innerText += " | SendData error: " + e.message;
            }

            // 4. ГЛАВНОЕ: Мгновенно меняем экран на "Спасибо"
            // Мы просто скрываем форму и показываем блок успеха
            document.getElementById('form-container').style.display = 'none';
            document.getElementById('success-screen').style.display = 'block';
        });
    </script>
</body>
</html>
